[[toc]]

## 区块链的定义

区块链就是一个**具有共享状态的密码性安全交易的单机(cryptographically secure transactional singleton machine with shared-state)**。这有点长，让我们将它分开来看：

1. “密码性安全(Cryptographically secure)”是指用一个很难被解开的复杂数学机制算法来保证数字货币生产的安全性。将它想象成类似于防火墙的这种。它们使得欺骗系统近乎是一个不可能的事情（比如：构造一笔假的交易，消除一笔交易等等）。
2. “交易的单机(Transactional singleton machine)”是指只有一个权威的机器实例为系统中产生的交易负责任。换句话说，只有一个全球真相是大家所相信的。
3. “具有共享状态(With shared-state)”是指在这台机器上存储的状态是共享的，对每个人都是开放的。

以太坊实现了区块链的这个范例。

### 什么是ETH

以太坊的本质就是一个基于交易的状态机(transaction-based state machine)

根据以太坊的状态机，从创世纪状态(genesis state)开始。这差不多类似于一片空白的石板，在网络中还没有任何交易的产生状态。当交易被执行后，这个创世纪状态就会转变成最终状态。在任何时刻，这个最终状态都代表着以太坊当前的状态。

为了让一个状态转换成下一个状态，交易必须是有效的。为了让一个交易被认为是有效的，它必须要经过一个**验证过程，此过程也就是挖矿**



### POW

POW（Proof of Work），工作量证明，引入了对一个特定值的哈希计算工作。

POW算法的概念是，矿工们在挖一个新的区块时，必须对SHA-256密码散列函数进行运算，区块中的随机散列值以一个或多个0开始。随着0数目的上升（难度增加），找到这个解所需要的工作量将呈指数增长，矿工通过反复尝试找到这个解。

总的来说，POW就是每发一条消息（上传一个区块）的时候，你要证明你付出了一定的算力，你的证据就是某串你加在区块里的无意义字符串，而加上这个字符串之后，你的区块的哈希值正好小于某个数（目标值nonce）。

哈希函数的特性告诉我们，你没有任何取巧的方法可以做到这一点——唯一的可能是，你真的一个一个字符串地去试了。

所以，我们知道你确实付出了很多的代价才能给出这么一个字符串。

**如何确保区块链的唯一不分叉**

我们定义了区块链就是一个具有共享状态的交易单机。使用这个定义，我们可以知道正确的当前状态是一**个全球真相**，所有人都必须要接受它。

如果拥有多个状态（或多个链）会摧毁这个系统，因为就没有人知道哪条链才是应该相信的。

为了确定哪个路径才是最有效的以及防止多条链的产生，以太坊使用了一个叫做“**GHOST协议**(GHOST protocol.)”的数学机制。

> GHOST = Greedy Heaviest Observed Subtree
>
> 简单来说，GHOST协议就是让我们必须选择一个在其上完成计算最多的路径。一个方法确定路径就是使用最近一个区块（叶子区块）的区块号，区块号代表着当前路径上总的区块数（不包含创世纪区块）。
>
> 区块号越大，路径就会越长，就说明越多的挖矿算力被消耗在此路径上以达到叶子区块。使用这种推理就可以允许我们赞同当前状态的权威版本。

**这也就是Pow算法所做的事情：**

它确保特定的区块链直到未来都一直保持着权威性，让攻击者创造一个新区块来重写某个历史部分（例如清除一个交易或者创建一个假的交易）或者保持一个分叉变得非常困难。

为什么困难呢？

因为如果你想篡改历史区块记录，那么你需要比全世界的算力更快。因为全世界算力都在不停的开发新区块，你需要篡改完指定区块后，如果已经有更新的区块出现，那你篡改的历史区块因为`ghost协议`会失效。

所以为了首先让他们的区块被验证，攻击者需要总是比网络上的其他人要更快的解决掉nonce问题，这样网络就会相信他们的链是最重的链（基于我们之前提到的GHOST协议原则）。

除非攻击者拥有超过一半的网络挖矿能力（这种场景也被称为[大多数51%攻击](https://en.bitcoin.it/wiki/Majority_attack) ），要不然这基本上是不可能的。

### 账户

以太坊的全局“共享状态”是有很多小对象（账户）来组成的，这些账户可以通过消息传递架构来与对方进行交互。

每个账户都有一个与之关联的**状态(state)**和一个20字节的**地址(address)。**

在以太坊中一个地址是160位的标识符，用来识别账户的。

有两种类型的账户：

1. **外部拥有的账户**，被私钥控制且没有任何代码与之关联

   可以理解为我们的钱包地址，通过私钥管理控制；

   一个外部拥有账户可以通过创建和用自己的私钥来对交易进行签名，来发送消息给另一个外部拥有账户或合约账户；

   在两个外部拥有账户之间传送的消息只是一个简单的价值转移，也就是**转账**。

   但是从**外部拥有账户到合约账户**的消息<u>会激活合约账户的代码</u>，允许它执行各种动作。（比如转移代币，写入内部存储，挖出一个新代币，执行一些运算，创建一个新的合约等等）。

2. **合约账户**，被它们的合约代码控制且有代码与之关联

   合约账户也就是智能合约，**合约账户不可以自己发起一个交易。**

   相反，合约账户只有在接收到一个交易之后(从一个外部拥有账户或另一个合约账户接)，为了响应此交易而触发一个交易。

因此，在以太坊上任何的动作，总是被外部控制账户触发的交易所发动的。



### 账户状态

账户状态有四个组成部分，不论账户类型是什么，都存在这四个组成部分：

1. nonce：

   如果账户是一个外部拥有账户，nonce代表从此账户地址发送的交易序号。如果账户是一个合约账户，nonce代表此账户创建的合约序号

2. balance： 

   此地址拥有Wei的数量。1Ether=10^18Wei

3. storageRoot： 

   Merkle Patricia树的根节点Hash值（我们后面在解释Merkle树）。Merkle树会将此账户存储内容的Hash值进行编码，默认是空值

4. codeHash：

   此账户EVM（以太坊虚拟机，后面细说）代码的hash值。对于合约账户，就是被Hash的代码并作为codeHash保存。对于外部拥有账户，codeHash域是一个空字符串的Hash值

### 交易和消息

交易是外部世界和以太坊内部状态的桥梁。以太坊是一个基于交易的状态机，换句话说，在两个不同账户之间发生的交易才让以太坊全球状态从一个状态转换成另一个状态。

有两种类型的交易：消息通信和合约创建(也就是交易产生一个新的以太坊合约)。

### 区块

区块是如何完成的？

当我们说“完成”，取决于此块是新的还是已存在的，可以指两个不同的事情。

如果是个新块，就是指挖这个块所需的处理。

如果是已存在的块，就是指验证此块的处理。

不论哪种情况，一个块的“完成”都有4个要求：

1.  验证（或者，如果是挖矿的话，就是确定）ommers 在区块头中的每个ommer都必须是有效的头并且必须在当前块的6代之内
2. 验证（或者，如果是挖矿的话，就是确定）交易 区块中的gasUsed数量必须与区块中所列交易使用的累积gas量相等。（回忆一下，当执行一个交易的时候，我们会跟踪区块的gas计数器，也就跟踪了区块中所有交易使用的gas总数量）
3. 申请奖励（只有挖矿时） 受益人的地址会因为挖矿而获得5Ether（在以太坊[EIP-649](https://github.com/ethereum/EIPs/pull/669) 提案中，5ETH很快将会被减少为3ETH）。另外，对于每个ommer，当前块的受益人会获得额外的1/32当前块奖励金的奖励。最近，每个ommer区块的受益人能够得到一定量的奖励（有个特殊公式可以进行计算）。
4. 校验（或者，如果是挖矿的话，就是计算一个有效的）状态和nonce 确保所有的交易和改变的结果状态都被应用了，然后在区块奖励被应用于最终交易结果状态之后定义一个新块为状态。通过检查最终状态与存储在头中的状态树来进行验证。



> [文章引用-ETH详解](https://www.8btc.com/article/142319)





## POW和POS

> [POW挖矿-BTC](https://www.liaoxuefeng.com/wiki/1207298049439968/1311929771491361#0)

## 挖矿

挖矿分为

- 独自挖矿
- 加入矿池

你可以把挖矿想象成买彩票，电脑一秒可以买成千上万张彩票，计算能力越大的电脑买得越快，但中奖的只有特定的那一张

独自挖矿就是你的电脑自顾自的不停的买，中奖的你就有一大笔比特币，不中奖就一个也没有，以目前比特币的中奖率，一个小型矿工，大约两三个月中一次奖，运气差时，半年一分钱也得不到，这肯定不行啊，总不能不中奖时喝西北风吧

于是一堆矿工在一切商量，成立个联盟，不管谁中奖了，都拿出来，按照贡献平分，这样每天都能拿到钱，每天都有饭吃，这就是矿池

然而，现在比特币asic矿机横行，家用电脑的算力连最垃圾的矿机的万分之一都不够，你的算力太低，矿池是不带你玩的，毕竟管理也是需要成本的，你所做的贡献远小于矿池付出的成本

没了矿池，只能独自挖矿，从概率上看，大概10年也中不了奖

如果挖其他的不用asic矿机的币，家用电脑的算力就不会太寒碜，矿池带你玩，你就能每三五天赚的0.000001个币，然后积少成多









## ERC20标准

ERC20 Token

ERC20和代币一同出现， ERC20是以太坊定义的一个[代币标准](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20-token-standard.md)是一种发行代币合约必须要遵守的协议，该协议规定了几个参数\*\*——发行货币的名称，简称，发行量，要支持的函数等，只有支持了该协议才会被以太坊所认同。

erc20标准代码如下

```html
// https://github.com/ethereum/EIPs/issues/20

  contract ERC20 {
      function totalSupply() constant returns (uint totalSupply);
      function balanceOf(address _owner) constant returns (uint balance);
      function transfer(address _to, uint _value) returns (bool success);
      function transferFrom(address _from, address _to, uint _value) returns (bool success);
      function approve(address _spender, uint _value) returns (bool success);
      function allowance(address _owner, address _spender) constant returns (uint remaining);
      event Transfer(address indexed _from, address indexed _to, uint _value);
      event Approval(address indexed _owner, address indexed _spender, uint _value);
    }
```

> totalSupply: 代表的是代币发行总量  totalSupply():该方法可以返回代币的总数量
>
> name: 发行代币的名称            dicimals: 发行代币以后，代币交易的最小单位
>
> balanceOf(): 该方法返回的是输入钱包地址后，该钱包的代币余额
>
> tansferFrom() :从一个地址向另一个地址发送余额
>
> approve(): 允许_spender从你的账户转出_value余额
>
> allowance(): 允许_spender从你的账户转出_value的余额，调用多次会覆盖可用量。某些DEX功能需要此功能
>
> event Transfer():  token转移完成后出发
>
> event Approval():  approve(address _spender, uint256 _value)调用后触发



## 主网与测试网

首先需要了解ETH网络概念；

以太坊存在测试网络，

- 主网好比我们做传统互联网项目开发的prd环境.

  绝大多数人在使用的网络被称为**主网络(Mainnet)**，用户在其上交易、构建智能合约，矿工在其上挖矿。由于使用的人数众多，主网络的鲁棒性很强，能够对抗攻击，区块链也不易被篡改，因此主网络是具有功能的，其上的以太币是有价值的。

- 而以太坊的测试网络好比dev环境. 

  *测试网的重要用途:*在无需真金白银的情况下,部署合约,玩转测试网下的dapp. 当前以太坊测试网,有:kovan, ropsten,rinkeby.

  以太坊也可以搭建私有的测试网络，不过由于以太坊是一个去中心化的平台，需要较多节点共同运作才能得到理想的测试效果，因此并不推荐自行搭建测试网络。

> 引用文档介绍：
>
> [测试网区别](https://ethluz.github.io/blog/eth/eth-use-all-test-network/)
>
> [ETH测试网详解](https://zhuanlan.zhihu.com/p/29010231)





## 智能合约

举个例子，来明白什么是ETH智能合约；

比特币存在一些问题，也是所有第一代区块链都存在的问题。**他们只允许货币交易，没有办法为这些交易添加条件。**

Alice可以发送Bob 5 BTC，但她不能对这些交易施加条件。例如。她不能告诉鲍勃，只有当他执行某些任务时他才能拿到钱。

这些条件将需要非常复杂的脚本，需要一种“东西”使流程更加无缝。...这个“东西”是就是以太坊的**智能合约**。



开发智能合约IDE

[Remix Solidity IDE 快速入门](https://blog.51cto.com/zero01/2366173)

以太坊的开发remix下运行环境的三种选项

常见我们使用Injected Web3环境结合MetaMask浏览器插件即可使用；

> - ### JavaScript VM:
>
>   这是Remix自己的内部沙箱。 **它不连接到MainNet，TestNet或任何专用网络**。这是一个内存中的区块链，可用于简单测试和快速挖掘。
>
> - ### Injected Web3:
>
>   这是用于浏览器插件（MetaMask）的选项。在这里，您要告诉Remix将对区块链集成的所有控制权交给MetaMask插件。
>
>   此时，MetaMask控制您要连接到的网络。 
>
>   在该插件中，您可以通过Infura的节点网络连接到MainNet，Ropsten，Rinkeby等。在这种情况下，您不是在本地运行节点。 MetaMask还具有localhost选项，您可以在其中本地运行自己的节点，MetaMask将向其发送所有事务（此本地网络可以是使用任何节点客户端的专用网络，也可以使用TestRPC等测试区块链）。
>
> - ### Web3 Provider:
>
>   **这允许您在Remix中输入URL以连接到区块链。**此处最常见的设置是运行本地节点并通过其IP /端口连接到本地节点。 **这与使用MetaMask的localhost选项几乎相同，但是您只是要使插件不再是中间人。**就像选项＃2一样，您连接的网络取决于您配置本地计算机的方式。节点（可以是主节点，测试节点，私有节点等）。

## 以太坊GAS

gas翻译成中文就是天然气的意思，见名知意；

Gas是一个单位，用于测量执行某些操作所需的计算量。gas度量的最小单位是wei，所以，如果我们在操作过程中花费1个gas单位，我们称它为1 wei。

以太坊虚拟机（EVM）中运行的所有智能合约都使用 solidity进行编码（以太坊计划未来将从Solidity转移到Viper。）每一行代码都需要一定量的gas来计算，就好比汽车要用汽油。

所以，Gas机制的存在，就是为了**激励和网络保护**；

- ### 激励

  像任何工作对等系统一样，以太坊严重依赖矿工的哈希效率：更多的矿工，更多的哈希效率，更安全和快速的系统。

  所以，gas和以太币不是一回事，就如燃料（gas）和费用（fee）不是同一回事一般。

  gas是需要的计算能力的数量，而以太币是价格，也就是人们必须为这种gas支付的费用。

- ### 网络保护

  以太坊是一个图灵完备语言，这就允许有循环，并使以太坊受到[停机问题](https://en.wikipedia.org/wiki/Halting_problem) 的影响，这个问题让你无法确定程序是否无限制的运行。

  如果没有费用的话，恶意的执行者通过执行一个包含无限循环的交易就可以很容易的让网络瘫痪而不会产生任何反响。

  因此，费用保护网络不受蓄意攻击。

> [GAS详解](https://zhuanlan.zhihu.com/p/34960267)





## 流动性挖矿

流动性挖矿是一种通过质押您的加密货币，来获取更多加密货币的方法。

它是通过计算机程序将您的资金质押给别人，这种计算机程序就是所谓的智能合约；

[流动性挖矿详解](https://academy.binance.com/zh/articles/what-is-yield-farming-in-decentralized-finance-defi)



## DAI币

> Dai是一种稳定币(stablecoin)。稳定币的概念非常简单– 和比特币和以太币一样是区块链上的一种Token。
>
> *关于稳定币，有usdt、maker和basecoin，其中三个的机制各不相同，usdt锚定美元，maker用以太抵押，basecoin完全通过去中心化的智能合约控制价格。三个代表都在实践自己的模型*
>
> 但和比特币或以太币不一样的是，Dai没有波动性。“有什么东西没有波动性的？波动性是相对的！”嗯。Dai是与美元挂钩的相对稳定的资产。所以，总而言之，1Dai 等于 1 USD。Dai将成为第一个消费级稳定币。

Maker智能合约的核心是CDP。我们用一个类比来描述。例如你在银行要求用房屋净值来抵押贷款。你把你的房子当作抵押品，他们给你发放现金贷款。如果你的房子市值下降，他们会要求你偿还贷款。

如果你不能偿还贷款，他们会拿你的房子拍卖。为了让这件事回到Maker身上，只需用ether代替你的房子，用智能合约代替银行，并以Dai代替贷款。当您把ether（抵押品）交给Maker的CDP智能合约（银行）时，系统向你发放Dai（贷款）。如果您的ether币值低于某个值时，您必须像偿还银行贷款一样偿还智能合约Dai，否则它会将您的ether将被拍卖。

总之，CDP只是Maker系统中存放抵押品（ether）的地方。

> [DAI详解](https://zhuanlan.zhihu.com/p/35416373)
>
> [DAI的用途场景](https://ethfans.org/posts/top-10-use-cases-and-benefits-of-the-dai-stablecoin)





## 空气币上交易所指南

> [造币指南](https://www.physixfan.com/xiangxituwenjiaochengruhe10fenzhongchengweishijieshoufu/)
>
> [制作ETH代币](https://blog.csdn.net/JAVA_HHHH/article/details/79771752)
>
> 如何制作空气币，这里有详解介绍；只要5分钟，ERC20代币就是这么简单！















## 币汇集

- ETH 在升级过渡的时间，Algorand，Cardano 这些新型学院派网络建设速度也在快速增长，且 Algorand 的 ATOMIC SWAP 与价值传输跨链能力上，具有巨大的潜力。Cardano 的 Shelley 也在一拖再拖后终于上线，并且走势不错，TEZOS, EOS, TRON 等传统 PoS 项目近期也都有新的动作。


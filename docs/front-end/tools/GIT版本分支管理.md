## 代码分支管理&&发布npm包规范

### 代码分支名称规范

#### 开发分支命名

| **分支名称** | **描述** |
| ------------ | -------- |
| master       | 生产环境 |
| release      | 预发环境 |
| qa           | 测试环境 |
| local        | 本地环境 |
| develop      | 开发环境 |

#### 其他分支名

| **分支名称前缀** | **描述**                         |
| ---------------- | -------------------------------- |
| feature          | 功能分支                         |
| bug              | bug分支，仅用于测试环境          |
| hotfix           | 热修复分支，仅用于生产、预发环境 |

**注意：**

1. 如果是生产环境的热修复，首先基于 master 分支拉取热修复分支。修改完成之后将热修复分支 merge 到 master 分支，遴选到 release、 qa 和 develop 分支（release、qa、develop 是遴选，不是 merge）。 
2. 如果是预发环境的热修复，首先基于 release 分支拉取热修复分支。修改完成之后将热修复分支 merge 到 release 分支、遴选到 qa、develop  分支（qa、develop 是遴选，不是merge）。

**其他分支的命名规范：**

1.feature 和 bug

feature/bug-人名-时间(完整年月)-功能描述(中英文不限)

2.hotfix

hotfix-人名-来源-时间-功能描述

## npm 包命名及发布规范

#### 版本号简介

软件版本号有四部分组成：

- 第一部分为主版本号，表示有大的动作，一般不会变
- 第二部分为次版本号，用于控制迭代版本

- 第三部分为修订版本号，用于本次迭代正式环境的版本更新
- 第四部分为希腊字母版本号加小版本号，希腊字母版本号共有三种，分别为base、alpha、beta

- 第三部分和第四部分之间使用 - 符号分隔

![img](https://cdn.nlark.com/yuque/0/2021/png/1090594/1614905669069-e43d2b52-75b1-4e47-97ef-d3671cdc7f59.png)

关于希腊版本号解释：

| 希腊版本号 | 描述             |
| ---------- | ---------------- |
| base       | 用于本地开发环境 |
| alpha      | 用于测试环境     |
| beta       | 用于预发环境     |

**注意：**正式版本不包含第四部分

#### npm 版本号更新规则

假设上次迭代结束时，最后一次正式环境 npm 包版本是 **1.2.6** 。

开发规则（develop）

- 本次迭代中的某个功能完成并需要提测时（完成的定义：前端后端都完成，且已自测完毕），首先将自己的功能分支 merge 到 develop 分支，然后将 develop 分支代码 merge 到 qa  分支。

测试环境规则（qa）

- 上次迭代结束，本次迭代功能首次要发布**测试环境**时，npm 包的版本应该是 1.3.0-alpha（新的迭代开始，递增第二部分版本号，并且添加第四部分标示 **alpha**）；
- 其他分支 merge 到 qa 分支（包括新功能和bug修复），需要发布 npm 包时，只需递增第四部分数组位的版本号（eg:1.3.0-beta.1）；

- 综上所述，qa 环境不论是新开发功能，还是修复 bug，其他分支 merge 到 qa 分支（包括新功能和 bug 修复），需要发布 npm 包时，只需递增第四部分数组位的版本号。

预发环境规则（release）

- 本次迭功能首次要发布**预发环境**时，npm 包的版本应该是1.3.0-beta（添加第四部分标示 **beta**）；
- 其他分支 merge 到 release 分支（包括来自qa 分支的merge和热修复），需要发布 npm 包时，只需递增第四部分数组位的版本号（eg:1.3.0-beta.1）。

生产环境规则 （master）

- 本次迭代功能首次要发布**生产环境**时，npm包的版本应该是1.3.0；
- 其他分支 merge 到 master 分支（包括来自release 分支的merge和热修复），需要发布 npm 包时，只需递增第三部分数组位的版本号（eg:1.3.1）。

#### hotfix 规则

​	假设上次迭代结束时，最后一次**生产环境 npm 包版本是 1.3.8**、**预发环境 npm 包版本是 1.3.0-beta.6** ，本次迭代 npm 版本是 **1.4.x**。本规则适用于生产环境、预发环境。

- 当本次迭代已经开始，发现上次迭代**预发环境**存在bug时，应当基于上次迭代 release 分支上发布的 **1.3.0-beta.6** 版本对应的节点拉取 hotfix 分支，当热修复完成，需要发布的 npm 包时，此时的版本号应该是 **1.3.0-beta.7**。
- 当本次迭代已经开始，发现上次迭代**生产环境**存在bug时，应当基于上次迭代 master 分支上发布的 **1.3.8** 版本对应的节点拉取 hotfix 分支，当热修复完成，需要发布 npm 包时，此时的版本号应该是**1.3.9**。

### 如何建立、合并分支

- 当新开迭代时，每个人需要根据自己的功能，拉取一个功能分支（切记，不要将多个功能拉在同一个分支上）；
- 功能开发完成之后需要提测时，需要将自己的分支 merge 到 develop 分支，再将 develop 分支 merge 到 qa，然后在 qa 分支发布 npm 包；

- 功能需要上**预发环境**时，将已经合并到 qa 分支的代码 merge 到 release 分支，然后在 release 分支发布 npm 包；
- 功能需要上**生产环境**时，将已经合并到 release 分支的代码 merge 到 master 分支，然后在 master 分支发布 npm 包。

### 注意

1. 每次commit必须写清楚做了什么！
2. 本次迭代不上线的功能请不要合到 develop、qa、release、master 分支。
## 流媒体

流媒体是指采用流式传输方式在 Internet 上播放的媒体格式，例如音频、视频等多媒体文件。

## 流式传输方式

流式传输方式是将多媒体文件经过特殊压缩后分成一个个压缩包，再由服务器向客户端连续、实时传送。

用户不必像非流式传输那样等待整个文件全部下载完毕后才能播放，而是只需要经过几秒钟或几十秒的启动延时即可对压缩的音视频文件进行播放，剩余的部分将继续下载，直至播放完毕。

## 流媒体传输协议

常用的流媒体传输协议主要有`HTTP渐进式下载`和`实时流媒体协议`两类。

### HTTP渐进式下载

仅能传输完整的音视频文件，在给定时刻，用户只能观看已下载的那部分，而不能跳到还未下载的部分。

HTTP边下载边播放，严格意义上讲，不是直播协议。

他的原理是先下载文件的基本信息，音频视频的时间戳，再下载音视频数据，以播放mp4为例，先下载文件头，根据文件头指引下载文件尾，然后再下载文件的音视频数据。

### 实时流媒体协议

可用于实况直播，也可传输完整的音视频文件。

例如RTSP/RTP、RTMP、HLS、HTTP-FLV。

## 直播流协议

### RTMP（Real Time Messaging Protocol）

协议比较全能，既可以用来推送，又可以用来直播。

其核心理念是将大块的视频帧和音频帧“剁碎”，然后以小数据包的形式在互联网上进行传输，且支持加密，因此隐私性相对比较理想，但拆包组包的过程比较复杂，所以在海量并发时容易出现一些不可预期的稳定性问题。

### HLS（HTTP Live Streaming）

苹果推出的解决方案，将视频分成 5-10 秒的视频小分片，然后用 M3U8 索引表进行管理。

由于客户端下载到的视频都是 5-10 秒的完整数据，故视频的流畅性很好，但也同样引入了很大的延迟（HLS 的一般延迟在 10-30s 左右）。

相比于 FLV，HLS 在iPhone 和大部分 Android 手机浏览器上的支持非常给力，所以常用于 QQ 和微信朋友圈的 URL 分享。

### HTTP-FLV（Flash Video）

由 Adobe 公司主推，格式极其简单，只是在大块的视频帧和音视频头部加入一些标记头信息，由于这种极致的简洁，在延迟表现和大规模并发方面都很成熟。

唯一的不足就是在手机浏览器上的支持非常有限，但是用作手机端 APP 直播协议却异常合适。





在支持浏览器的协议里，延迟排序(由高到低)是：

**HLS > WebSocket-FLV >RTMP = HTTP-FLV**

而性能排序(由高到低)恰好相反：

**RTMP > HTTP-FLV = WebSocket-FLV > HLS**








## CDN

**全称**:Content Delivery Network，即内容分发网络

## CDN 做了什么

![img](//img.callbackhell.xyz/vuepress/evo/cdn1.png)

从这张图出发，很形象的描述了一下 CDN 到底做了什么；

1. 我们通过浏览器访问`www.dd.com`域名，请求域名 URL 发给 DNS 服务器解析；

2. 常规 DNS 服务器会解析域名后，直接返回映射服务器的 IP；

   但当我们使用了 CDN 加速，DNS 服务器会解析返回给我们该域名对应 CDN 服务器的 cname；

3. 我们使用 cname 实际访问的是 CDN 调度服务器；

4. 调度服务器会根据用户 IP 地址和请求 URL 内容，根据负载均衡查询距离我们最近的**缓存服务器**，并返回缓存服务器 IP；

   （这里实际还存在 CDN 全局负载均衡服务器，区域负载均衡服务区器，实现功能都是在为我们分发最合适最近的缓存服务器 ID；我们通称为**调度服务器**）

5. 实际用户真实访问的是缓存服务器，如果缓存服务器上已缓存了所需的数据，那么就直接相应请求；

   但如果此服务器目前第一个用户进行访问呢？

   此时并没有所需的数据，那么缓存服务器会向它的上级调度服务器获取数据，此时上级调度服务器就叫做**源站**，而获取数据这个过程就叫做**回源**，然后再将回源的数据返回给用户；

这就是 CDN 加速的流程，我们详细讲一下涉及的几个名词：

## 专有名词

- ### 回源：

  CDN 节点获取数据分为源站主动推送和 CDN 回源获取

  - 源站内容有更新的时候，源站主动把内容推送到 CDN 节点。

  - 常规回源方式是：

    如果缓存服务器被访问时，没有响应的内容或内容已经过期，就会重新执行回源的操作；

    当没有请求访问时，缓存服务器不会主动回源。

- ### 源站：

  支持缓存服务器回源数据的上一级服务器，负责提供回源数据。

- ### 缓存服务器：

  就是你通过 CDN 加速后，实际给你提供资源的服务器

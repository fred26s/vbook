<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器缓存策略 | BLOG</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/vbook/favicon.ico">
    <meta name="description" content="学习笔记">
    <link rel="preload" href="/vbook/assets/css/0.styles.e0606203.css" as="style"><link rel="preload" href="/vbook/assets/js/app.56a9a2ed.js" as="script"><link rel="preload" href="/vbook/assets/js/2.2ce5df5b.js" as="script"><link rel="preload" href="/vbook/assets/js/34.d37fab85.js" as="script"><link rel="prefetch" href="/vbook/assets/js/10.09b2ea05.js"><link rel="prefetch" href="/vbook/assets/js/11.b33443e5.js"><link rel="prefetch" href="/vbook/assets/js/12.31280131.js"><link rel="prefetch" href="/vbook/assets/js/13.1ae03640.js"><link rel="prefetch" href="/vbook/assets/js/14.d41b2257.js"><link rel="prefetch" href="/vbook/assets/js/15.b571d130.js"><link rel="prefetch" href="/vbook/assets/js/16.8a84fe06.js"><link rel="prefetch" href="/vbook/assets/js/17.be4efc3d.js"><link rel="prefetch" href="/vbook/assets/js/18.d449664b.js"><link rel="prefetch" href="/vbook/assets/js/19.8f8c2dff.js"><link rel="prefetch" href="/vbook/assets/js/20.5d3267da.js"><link rel="prefetch" href="/vbook/assets/js/21.a6523cdd.js"><link rel="prefetch" href="/vbook/assets/js/22.c640d9af.js"><link rel="prefetch" href="/vbook/assets/js/23.879bf70a.js"><link rel="prefetch" href="/vbook/assets/js/24.bd48ace9.js"><link rel="prefetch" href="/vbook/assets/js/25.0f12410b.js"><link rel="prefetch" href="/vbook/assets/js/26.718ccfa4.js"><link rel="prefetch" href="/vbook/assets/js/27.f153037d.js"><link rel="prefetch" href="/vbook/assets/js/28.508d01f9.js"><link rel="prefetch" href="/vbook/assets/js/29.dbe0222b.js"><link rel="prefetch" href="/vbook/assets/js/3.dfccb20d.js"><link rel="prefetch" href="/vbook/assets/js/30.9988d278.js"><link rel="prefetch" href="/vbook/assets/js/31.6008081f.js"><link rel="prefetch" href="/vbook/assets/js/32.6d16c0dd.js"><link rel="prefetch" href="/vbook/assets/js/33.e4e21daf.js"><link rel="prefetch" href="/vbook/assets/js/35.6f741ed5.js"><link rel="prefetch" href="/vbook/assets/js/36.58d8b589.js"><link rel="prefetch" href="/vbook/assets/js/37.674e27ab.js"><link rel="prefetch" href="/vbook/assets/js/38.fa018258.js"><link rel="prefetch" href="/vbook/assets/js/39.2f197b8d.js"><link rel="prefetch" href="/vbook/assets/js/4.d599a372.js"><link rel="prefetch" href="/vbook/assets/js/40.60890a66.js"><link rel="prefetch" href="/vbook/assets/js/41.99ac89f4.js"><link rel="prefetch" href="/vbook/assets/js/42.fc4ec52c.js"><link rel="prefetch" href="/vbook/assets/js/43.f3404978.js"><link rel="prefetch" href="/vbook/assets/js/44.98c5c2de.js"><link rel="prefetch" href="/vbook/assets/js/45.4f1b0703.js"><link rel="prefetch" href="/vbook/assets/js/46.ed7569c8.js"><link rel="prefetch" href="/vbook/assets/js/5.4413bd57.js"><link rel="prefetch" href="/vbook/assets/js/6.0afd5f60.js"><link rel="prefetch" href="/vbook/assets/js/7.61ee7893.js"><link rel="prefetch" href="/vbook/assets/js/8.aa2210e7.js"><link rel="prefetch" href="/vbook/assets/js/9.2be3499c.js">
    <link rel="stylesheet" href="/vbook/assets/css/0.styles.e0606203.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vbook/" class="home-link router-link-active"><!----> <span class="site-name">BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端学习笔记" class="dropdown-title"><span class="title">前端学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端学习笔记" class="mobile-dropdown-title"><span class="title">前端学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/front-end/evo/优化方式.html" class="nav-link">
  前端优化
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/js/es6知识.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/vue/vue知识点.html" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/webpack/webpack基础.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/net/网络基础.html" class="nav-link">
  网络基础
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/tools/GIT.html" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/ci/travis自动部署.html" class="nav-link">
  前端自动化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后台学习笔记" class="dropdown-title"><span class="title">后台学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="后台学习笔记" class="mobile-dropdown-title"><span class="title">后台学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/back-end/node/express.html" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/vbook/back-end/lib-web/RESTful.html" class="nav-link">
  web开发知识
</a></li><li class="dropdown-item"><!----> <a href="/vbook/back-end/server/Nginx.html" class="nav-link">
  服务器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JustDoIT" class="dropdown-title"><span class="title">JustDoIT</span> <span class="arrow down"></span></button> <button type="button" aria-label="JustDoIT" class="mobile-dropdown-title"><span class="title">JustDoIT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/funs/hardware/arduino.html" class="nav-link">
  硬件
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端学习笔记" class="dropdown-title"><span class="title">前端学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端学习笔记" class="mobile-dropdown-title"><span class="title">前端学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/front-end/evo/优化方式.html" class="nav-link">
  前端优化
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/js/es6知识.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/vue/vue知识点.html" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/webpack/webpack基础.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/net/网络基础.html" class="nav-link">
  网络基础
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/tools/GIT.html" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/ci/travis自动部署.html" class="nav-link">
  前端自动化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后台学习笔记" class="dropdown-title"><span class="title">后台学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="后台学习笔记" class="mobile-dropdown-title"><span class="title">后台学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/back-end/node/express.html" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/vbook/back-end/lib-web/RESTful.html" class="nav-link">
  web开发知识
</a></li><li class="dropdown-item"><!----> <a href="/vbook/back-end/server/Nginx.html" class="nav-link">
  服务器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JustDoIT" class="dropdown-title"><span class="title">JustDoIT</span> <span class="arrow down"></span></button> <button type="button" aria-label="JustDoIT" class="mobile-dropdown-title"><span class="title">JustDoIT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/funs/hardware/arduino.html" class="nav-link">
  硬件
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vbook/front-end/evo/优化方式.html" class="sidebar-link">浏览器</a></li><li><a href="/vbook/front-end/evo/gulp优化.html" class="sidebar-link">gulp优化压缩</a></li><li><a href="/vbook/front-end/evo/cdn.html" class="sidebar-link">CDN加速</a></li><li><a href="/vbook/front-end/evo/浏览器缓存.html" class="active sidebar-link">浏览器缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#浏览器缓存策略" class="sidebar-link">浏览器缓存策略</a></li><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#_1-判断是否存在缓存" class="sidebar-link">1.判断是否存在缓存</a></li><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#_2-判断缓存是否过期" class="sidebar-link">2.判断缓存是否过期</a></li><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#_3-判断-etag" class="sidebar-link">3.判断 ETag</a></li><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#etag" class="sidebar-link">ETag</a></li><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#if-none-match" class="sidebar-link">If-None-Match</a></li><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#_4-判断-last-modified" class="sidebar-link">4.判断 Last-Modified</a></li><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#last-modified" class="sidebar-link">Last-Modified</a></li><li class="sidebar-sub-header"><a href="/vbook/front-end/evo/浏览器缓存.html#if-modified-since" class="sidebar-link">If-Modified-Since</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="浏览器缓存策略"><a href="#浏览器缓存策略" class="header-anchor">#</a> 浏览器缓存策略</h2> <p>一张图介绍浏览器在处理缓存策略时的步骤</p> <p><img src="//img.joyfred.com/vuepress/evo/brw-cache.jpg" alt="img"></p> <p>分析一下图中几个关键分支点：</p> <h2 id="_1-判断是否存在缓存"><a href="#_1-判断是否存在缓存" class="header-anchor">#</a> 1.判断是否存在缓存</h2> <p>浏览器如何判断当前资源是否存在缓存呢？</p> <p>这里可分为 <strong>强制缓存</strong> 和 <strong>协商缓存</strong>；</p> <p><strong>强制缓存</strong></p> <p>即通过服务器响应头中的 <code>expires和cache-control</code>来判断；（这两个标头后面详解）</p> <p>如果还在强制缓存的有效期内，直接获取缓存数据资源；</p> <p><strong>协商缓存</strong></p> <p>如果强制缓存失效，那么即进入协商缓存，</p> <p>浏览器会在请求头上带上标头<code>Etag / If-None-Match</code>和<code>Last-Modified / If-Modified-Since</code>;</p> <p>服务端通过这两组标头进行判断资源是否发生改变，决定返回 304/200；</p> <h2 id="_2-判断缓存是否过期"><a href="#_2-判断缓存是否过期" class="header-anchor">#</a> 2.判断缓存是否过期</h2> <p>通过首次请求资源时，服务端响应头中的<code>expires和cache-control</code>,表示了缓存有效期；</p> <p><strong>expires</strong></p> <p>Expires 是 HTTP/1.0 控制网页缓存的字段，其值为服务器返回该请求结果缓存的到期准确时间，</p> <p>例如<code>expires: Sat, 06 Jun 2020 09:24:34 GMT</code></p> <p>即再次发起该请求时，如果客户端的时间小于 Expires 的值时，直接使用缓存结果。</p> <p><strong>cache-control</strong></p> <p>cache-control 是 HTTP/1.1 控制网页缓存的字段， 其值为一个数字相对值，以秒为单位；</p> <p>例如 <code>Cache-Control: max-age=300</code></p> <p>即在此发起该请求时，如果在 Date+maxage 时间长度内，直接使用缓存结果；</p> <blockquote><p>注：在无法确定客户端的时间是否与服务端的时间同步的情况下，Cache-Control 相比于 expires 是更好的选择，所以同时存在时，只有 Cache-Control 生效。</p></blockquote> <h2 id="_3-判断-etag"><a href="#_3-判断-etag" class="header-anchor">#</a> 3.判断 ETag</h2> <p>当判断缓存过期后，即进入了协商缓存阶段；</p> <p>上面说了协商缓存阶段，会根据请求头中的两组标头来判断；</p> <p>分别是</p> <p><code>Etag / If-None-Match</code>和<code>Last-Modified / If-Modified-Since</code>;</p> <p>先来介绍下这两个值的意义和来源；</p> <ul><li><h2 id="etag"><a href="#etag" class="header-anchor">#</a> ETag</h2> <p>Etag 是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)</p></li> <li><h2 id="if-none-match"><a href="#if-none-match" class="header-anchor">#</a> If-None-Match</h2> <p>是客户端再次发起该请求时，携带上次请求返回的唯一标识 Etag 值，用以交给服务端判断过程</p></li></ul> <h3 id="过程"><a href="#过程" class="header-anchor">#</a> 过程</h3> <p>过程是这样的，第一个请求时服务端在响应头中就返回客户端一个<code>ETag</code>，用来表示当前文件的唯一值；</p> <p>当你再次第二次请求时，浏览器在请求头中加上了<code>If-None-Match</code>这个标头，值就是之前的<code>ETag</code>;</p> <p>服务端会校验你的<code>Etag</code>是否和最新的文件相同，决定返回 304/200；</p> <h2 id="_4-判断-last-modified"><a href="#_4-判断-last-modified" class="header-anchor">#</a> 4.判断 Last-Modified</h2> <p>和上面<code>ETag</code>相同，浏览器还会增加一组校验标头<code>Last-Modified / If-Modified-Since</code></p> <p>这两个值的意义：</p> <ul><li><h2 id="last-modified"><a href="#last-modified" class="header-anchor">#</a> Last-Modified</h2> <p>Last-Modified 是服务器响应请求时，返回该资源文件在服务器最后被修改的时间</p></li> <li><h2 id="if-modified-since"><a href="#if-modified-since" class="header-anchor">#</a> If-Modified-Since</h2> <p>If-Modified-Since 则是客户端再次发起该请求时，携带上次请求返回的 Last-Modified 值，用以交给服务端判断</p></li></ul> <h3 id="过程-2"><a href="#过程-2" class="header-anchor">#</a> 过程</h3> <p>和<code>ETag</code>机制相同，都是在响应体中首先拿到保存<code>Last-Modified</code>，在第二次请求中发送<code>If-Modified-Since</code>给服务端；</p> <p>这里需要注意的是，<code>ETag</code>相比<code>Last-Modified</code>优先级更高；</p> <p>也就是说，当<code>ETag</code>改变证明文件唯一性已经发生了变化，直接可判断资源更新；</p> <p>而当<code>ETag</code>没变，再去校验<code>Last-Modified</code>，最后修改时间是否一致；</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vbook/front-end/evo/cdn.html" class="prev">
        CDN加速
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vbook/assets/js/app.56a9a2ed.js" defer></script><script src="/vbook/assets/js/2.2ce5df5b.js" defer></script><script src="/vbook/assets/js/34.d37fab85.js" defer></script>
  </body>
</html>

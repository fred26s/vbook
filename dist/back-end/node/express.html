<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>express | BLOG</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/vbook/favicon.ico">
    <meta name="description" content="学习笔记">
    <link rel="preload" href="/vbook/assets/css/0.styles.e0606203.css" as="style"><link rel="preload" href="/vbook/assets/js/app.3b385a05.js" as="script"><link rel="preload" href="/vbook/assets/js/2.2ce5df5b.js" as="script"><link rel="preload" href="/vbook/assets/js/22.c1aad3a2.js" as="script"><link rel="prefetch" href="/vbook/assets/js/10.6f2d8bc8.js"><link rel="prefetch" href="/vbook/assets/js/11.c69ee5aa.js"><link rel="prefetch" href="/vbook/assets/js/12.e204f4f1.js"><link rel="prefetch" href="/vbook/assets/js/13.1883e67e.js"><link rel="prefetch" href="/vbook/assets/js/14.755d7778.js"><link rel="prefetch" href="/vbook/assets/js/15.7e722045.js"><link rel="prefetch" href="/vbook/assets/js/16.8a84fe06.js"><link rel="prefetch" href="/vbook/assets/js/17.d851d255.js"><link rel="prefetch" href="/vbook/assets/js/18.10bf8f28.js"><link rel="prefetch" href="/vbook/assets/js/19.b4d18bac.js"><link rel="prefetch" href="/vbook/assets/js/20.e82790c5.js"><link rel="prefetch" href="/vbook/assets/js/21.ef1a1af6.js"><link rel="prefetch" href="/vbook/assets/js/23.f403526b.js"><link rel="prefetch" href="/vbook/assets/js/24.447556ba.js"><link rel="prefetch" href="/vbook/assets/js/25.8f1830d8.js"><link rel="prefetch" href="/vbook/assets/js/26.1aee2451.js"><link rel="prefetch" href="/vbook/assets/js/27.a86b3044.js"><link rel="prefetch" href="/vbook/assets/js/28.508d01f9.js"><link rel="prefetch" href="/vbook/assets/js/29.dbe0222b.js"><link rel="prefetch" href="/vbook/assets/js/3.dfccb20d.js"><link rel="prefetch" href="/vbook/assets/js/30.29ae2259.js"><link rel="prefetch" href="/vbook/assets/js/31.ece9409c.js"><link rel="prefetch" href="/vbook/assets/js/32.455c0172.js"><link rel="prefetch" href="/vbook/assets/js/33.d78a6fd6.js"><link rel="prefetch" href="/vbook/assets/js/34.dbb055b1.js"><link rel="prefetch" href="/vbook/assets/js/35.158a349a.js"><link rel="prefetch" href="/vbook/assets/js/36.5791d7c4.js"><link rel="prefetch" href="/vbook/assets/js/37.ef1f5814.js"><link rel="prefetch" href="/vbook/assets/js/38.d69658c1.js"><link rel="prefetch" href="/vbook/assets/js/39.601fbcdd.js"><link rel="prefetch" href="/vbook/assets/js/4.d599a372.js"><link rel="prefetch" href="/vbook/assets/js/40.f6913db6.js"><link rel="prefetch" href="/vbook/assets/js/41.99ac89f4.js"><link rel="prefetch" href="/vbook/assets/js/42.dd0380bd.js"><link rel="prefetch" href="/vbook/assets/js/43.d033d384.js"><link rel="prefetch" href="/vbook/assets/js/44.0bf3fc34.js"><link rel="prefetch" href="/vbook/assets/js/45.fc46fe1d.js"><link rel="prefetch" href="/vbook/assets/js/46.b812e66f.js"><link rel="prefetch" href="/vbook/assets/js/5.525c50d0.js"><link rel="prefetch" href="/vbook/assets/js/6.f6b821c1.js"><link rel="prefetch" href="/vbook/assets/js/7.61ee7893.js"><link rel="prefetch" href="/vbook/assets/js/8.b54700d3.js"><link rel="prefetch" href="/vbook/assets/js/9.a6110085.js">
    <link rel="stylesheet" href="/vbook/assets/css/0.styles.e0606203.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vbook/" class="home-link router-link-active"><!----> <span class="site-name">BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端学习笔记" class="dropdown-title"><span class="title">前端学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端学习笔记" class="mobile-dropdown-title"><span class="title">前端学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/front-end/evo/优化方式.html" class="nav-link">
  前端优化
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/js/es6知识.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/vue/vue知识点.html" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/webpack/webpack基础.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/net/网络基础.html" class="nav-link">
  网络基础
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/tools/GIT.html" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/ci/travis自动部署.html" class="nav-link">
  前端自动化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后台学习笔记" class="dropdown-title"><span class="title">后台学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="后台学习笔记" class="mobile-dropdown-title"><span class="title">后台学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/back-end/node/express.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/vbook/back-end/lib-web/RESTful.html" class="nav-link">
  web开发知识
</a></li><li class="dropdown-item"><!----> <a href="/vbook/back-end/server/Nginx.html" class="nav-link">
  服务器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JustDoIT" class="dropdown-title"><span class="title">JustDoIT</span> <span class="arrow down"></span></button> <button type="button" aria-label="JustDoIT" class="mobile-dropdown-title"><span class="title">JustDoIT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/funs/hardware/arduino.html" class="nav-link">
  硬件
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端学习笔记" class="dropdown-title"><span class="title">前端学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端学习笔记" class="mobile-dropdown-title"><span class="title">前端学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/front-end/evo/优化方式.html" class="nav-link">
  前端优化
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/js/es6知识.html" class="nav-link">
  JS
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/vue/vue知识点.html" class="nav-link">
  VUE
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/webpack/webpack基础.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/net/网络基础.html" class="nav-link">
  网络基础
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/tools/GIT.html" class="nav-link">
  开发工具
</a></li><li class="dropdown-item"><!----> <a href="/vbook/front-end/ci/travis自动部署.html" class="nav-link">
  前端自动化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后台学习笔记" class="dropdown-title"><span class="title">后台学习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="后台学习笔记" class="mobile-dropdown-title"><span class="title">后台学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/back-end/node/express.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/vbook/back-end/lib-web/RESTful.html" class="nav-link">
  web开发知识
</a></li><li class="dropdown-item"><!----> <a href="/vbook/back-end/server/Nginx.html" class="nav-link">
  服务器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JustDoIT" class="dropdown-title"><span class="title">JustDoIT</span> <span class="arrow down"></span></button> <button type="button" aria-label="JustDoIT" class="mobile-dropdown-title"><span class="title">JustDoIT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vbook/funs/hardware/arduino.html" class="nav-link">
  硬件
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>NodeJS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vbook/back-end/node/express.html" aria-current="page" class="active sidebar-link">express</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vbook/back-end/node/express.html#express" class="sidebar-link">express</a></li><li class="sidebar-sub-header"><a href="/vbook/back-end/node/express.html#特性" class="sidebar-link">特性</a></li><li class="sidebar-sub-header"><a href="/vbook/back-end/node/express.html#范例" class="sidebar-link">范例</a></li><li class="sidebar-sub-header"><a href="/vbook/back-end/node/express.html#请求与响应" class="sidebar-link">请求与响应</a></li><li class="sidebar-sub-header"><a href="/vbook/back-end/node/express.html#路由" class="sidebar-link">路由</a></li><li class="sidebar-sub-header"><a href="/vbook/back-end/node/express.html#中间件" class="sidebar-link">中间件</a></li><li class="sidebar-sub-header"><a href="/vbook/back-end/node/express.html#路由器级中间件" class="sidebar-link">路由器级中间件</a></li></ul></li><li><a href="/vbook/back-end/node/服务端鉴权.html" class="sidebar-link">服务端鉴权</a></li><li><a href="/vbook/back-end/node/node后台-ts实现.html" class="sidebar-link">node后台搭建-TS篇</a></li><li><a href="/vbook/back-end/node/node后台-工具相关.html" class="sidebar-link">node后台搭建-工具环境篇</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="express"><a href="#express" class="header-anchor">#</a> express</h2> <p>最流行的nodejs框架；类似的还有koa等</p> <p>Express应用程序本质上就是一系列中间件函数调用。</p> <h2 id="特性"><a href="#特性" class="header-anchor">#</a> 特性</h2> <ol><li>路由系统简单易用</li> <li>机集众多模板引擎</li> <li>中间件系统</li></ol> <h2 id="范例"><a href="#范例" class="header-anchor">#</a> 范例</h2> <p>最简单的web服务器代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const express = require('express')
const app = express()

app.get('/', (req, res) =&gt; {
  res.send('&lt;h1&gt;fred HomePagefred HomePage&lt;/h1&gt;');
})

app.listen('5050');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这样我们就可以访问到了5050端口返回的文本；</p> <h2 id="请求与响应"><a href="#请求与响应" class="header-anchor">#</a> 请求与响应</h2> <p>上面例子返回响应使用了<code>res.send()</code>这个方法，</p> <p>这个方法不光可以返回字符串，甚至<code>json</code>、数组等都可以使用他来返回响应；</p> <blockquote><p>具体详细API参见官网文档：<a href="https://www.expressjs.com.cn/4x/api.html#express" target="_blank" rel="noopener noreferrer">https://www.expressjs.com.cn/4x/api.html#express<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <h3 id="路由传参"><a href="#路由传参" class="header-anchor">#</a> 路由传参</h3> <p>可以通过URL路由，使用请求动态传参；</p> <p>语法是在路由中使用<code>:</code>这个符号：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>app.get('/:name/get_json/:id', (req, res) =&gt; {
  const params = req.params
  const str = {
    name: params.name,
    color: 'gray',
    id: params.id
  }
  res.send(str);
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如上面这个示例，例如请求URL为： <code>localhost/fred/get_json/123</code>; 则响应内容为：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    &quot;name&quot;: &quot;fred&quot;,
    &quot;color&quot;: &quot;gray&quot;,
    &quot;id&quot;: &quot;123&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>中间件可以通过<code>req.params</code>，来接受URL中传递的参数；</strong></p> <h3 id="查询字符串"><a href="#查询字符串" class="header-anchor">#</a> 查询字符串</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>app.get('/', (req, res) =&gt; {
  res.send('query:' + req.query.name);   //返回url中的name
})

URL: localhost?name=fred
send: query: name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>query表示查询字符串的键值对；</p> <h3 id="post传参"><a href="#post传参" class="header-anchor">#</a> post传参</h3> <p>参数体传输在express中，需要借助<code>body-parse</code>这个中间件；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const express = require('express')
const app = express()
const bodyParser = require('body-parser')
app.use(bodyParser.json())               // 使用中间件

app.post('/', (req, res) =&gt; {
  console.log(req.body)
  res.send(req.body.name);   // 返回post请求体中的name
})

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="中间件"><a href="#中间件" class="header-anchor">#</a> 中间件</h2> <p>中间件，本质就是位于<strong>请求</strong>和<strong>响应</strong>这两个过程中间的处理函数，我们可以把它理解为一个从接收到请求，再执行完响应这个过程中间的<strong>流水线</strong>；</p> <p>在这个流水线中，我们可以执行一些影响响应数据的操作，一步一步的执行；</p> <p>中间件可以不止有一个，多个中间件之间以流水线的形式执行，</p> <p>a执行完，next()，通知b中间件执行；</p> <h3 id="next逻辑"><a href="#next逻辑" class="header-anchor">#</a> next逻辑</h3> <p>中间件作为管道形式，添加在请求和响应中间；</p> <p>可以在每一个中间件里，处理请求对象和响应对象；</p> <p>例如上一个中间件给请求对象添加了时间属性，下一个中间件里就可以拿到时间，并作出响应；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const setDate = (req, res, next) =&gt; {
  req.reqTime = new Date()
  next()
}
app.use(setDate)

app.get('/get_json', (req, res) =&gt; {
  const str = {
    name: 'fred',
    date: req.reqTime           // 这里可以获取上一步中间件设置的时间
  }
  res.send(str);
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="express路由分组机制"><a href="#express路由分组机制" class="header-anchor">#</a> Express路由分组机制</h3> <blockquote><p>Express的路由内部实现比较复杂，这里只挑有关的讲。</p> <p>Express中，路由是以组的形式添加的。什么意思呢，可以看下面伪代码</p> <p>app.get('/user/:id', fn1, fn2, fn3);</p> <p>app.get('/user/:id', fn4, fn5, fn6);</p> <p>在内部，Express把上面添加的路由，分成了两个组。继续看伪代码，可以看到，路由在内部被分成了两个组。</p> <p>var stack = [</p> <p>{path: '/user/:id', fns: [fn1, fn2, fn3], // 路由组1</p> <p>{path: '/user/:id', fns: [fn4, fn5, fn5] // 路由组2</p> <p>];</p> <p>路由匹配就是个遍历的过程，略。</p> <p>next('route')是干嘛的</p> <p>答案：跳过当前路由分组中，剩余的handler（中间件）</p> <p>如果没有next('route')，一路next()调用下去的话，调用顺序是这样的：</p> <p>fn1 -&gt; fn2 -&gt; fn3 -&gt; fn4 -&gt; fn5 -&gt; fn6</p> <p>假设某些情况下，在执行了fn1后，想要跳过fn2、fn3，怎么办？（比如楼主举的例子）</p> <p>答案就是在fn1里调用next('route')。</p> <p>然后就变成了</p> <p>fn1 -&gt; fn4 -&gt; fn5 -&gt; fn6</p></blockquote> <h2 id="路由器级中间件"><a href="#路由器级中间件" class="header-anchor">#</a> 路由器级中间件</h2> <p>可以使用<code>express.Router()</code>,来新建局部路由器级中间件；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// admin.js
var app = express()
var router = express.Router()

// 如果访问 localhost/0 跳入下一个路由组，返回special
router.get('/:id', function (req, res, next) {
  if (req.params.id === '0') next('route')  // 跳到下一个路由组
  else next()
}, function (req, res, next) {
  if (req.params.id === '1') next('router')  // 跳到下一个路由器
  else res.send('regular')
})

router.get('/:id', function (req, res, next) {
  console.log(req.params.id)
  res.send('special')               // 这里是第二个路由组， 由0跳入
})

// server.js
var app = express()
const cellRouter = require('admin.js')
app.use('/cell', cellRouter, function(req, res, next) {
    res.send('finally')             // 这里是第二个路由器
})
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>上面返回结果为：</p> <ul><li><code>localhost/cell/0</code> =》返回 <code>special</code></li> <li><code>localhost/cell/1</code> =》返回 <code>finally</code></li> <li><code>localhost/cell/2</code> =》返回 <code>regular</code></li></ul> <p><strong>这里先说一下为什么上面例子会按注释的说明执行；</strong></p> <p>因为Express中，路由是以组的形式添加的，</p> <p>上面例子中路由器中，相当于重复定义了两个相同的路由<code>/:id</code>；</p> <p>第一个路由包含两个路由组；第二个路由是一个路由组；</p> <p>next('route')，表示跳过当前路由分组中，剩余的中间件handler；</p> <p>next('router')，表示跳过当前整个路由router，上例跳过router后，就进入了<code>/cell</code>路由的第二个中间件；</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/vbook/back-end/node/服务端鉴权.html">
        服务端鉴权
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vbook/assets/js/app.3b385a05.js" defer></script><script src="/vbook/assets/js/2.2ce5df5b.js" defer></script><script src="/vbook/assets/js/22.c1aad3a2.js" defer></script>
  </body>
</html>

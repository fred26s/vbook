(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{355:function(s,e,t){"use strict";t.r(e);var a=t(42),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"邮箱验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#邮箱验证"}},[s._v("#")]),s._v(" 邮箱验证")]),s._v(" "),t("p",[s._v("用户注册后，需要实时进行邮箱验证（筛除垃圾账号）；")]),s._v(" "),t("p",[s._v("流程应为：")]),s._v(" "),t("ul",[t("li",[t("h3",{attrs:{id:"注册流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注册流程"}},[s._v("#")]),s._v(" 注册流程")])])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("用户注册后，完成后台注册接口后，")]),s._v(" "),t("p",[s._v("直接跳转到邮箱验证页，强制进行 验证邮箱；")]),s._v(" "),t("p",[s._v("此时用户 已存在数据库中，但属于"),t("strong",[s._v("未验证账号")]),s._v("；")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("- 这里注册成功后，即将用户账号信息，存储在客户端内存中（vuex）\n- 跳转到邮箱验证页，将内存中的用户信息发送后台，后台校验用户是否合法（是否注册）;\n- 验证通过后，给注册用户邮箱发送验证链接；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("邮箱验证会发送一个包含用户信息的"),t("code",[s._v("验证token链接")]),s._v("，点击后携带token会跳转到本系统的完成验证页面;")]),s._v(" "),t("p",[s._v("系统会用链接过来的token，自动发请求验证，获取当前用户的"),t("code",[s._v("excess_token")]),s._v("，存储在客户端；")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("- 完成验证页面获取excess_token后，就等同于已登录；\n- 验证成功后，默认几秒内跳转首页，完成邮箱验证；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("此前注册自动跳转的"),t("strong",[s._v("邮箱验证页")]),s._v("包含"),t("code",[s._v("确认已激活")]),s._v("按钮，点击目标的前端路由为系统首页；")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("- 这里用户点击按钮前，若已成功验证邮箱，则用户状态为正常（已验证 EMAIL_IVERIFY）\n  并且客户端浏览器已经保存了token，所以点击按钮就可进入系统；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])]),s._v(" "),t("ul",[t("li",[t("h3",{attrs:{id:"登录流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录流程"}},[s._v("#")]),s._v(" 登录流程")]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("access_token")])]),s._v(" "),t("p",[s._v("访问token，可访问系统内所有资源接口")]),s._v(" "),t("ul",[t("li",[s._v("email_token")])]),s._v(" "),t("p",[s._v("邮箱验证token，在邮件中发送，用来验证用户邮箱合法性；")]),s._v(" "),t("ul",[t("li",[s._v("send_email_token")])]),s._v(" "),t("p",[s._v("发送验证邮件的权限token，为避免滥发邮件接口，需要登陆后携带此token申请接受邮件")]),s._v(" "),t("p",[t("strong",[s._v("[限制只有登录用户，才有权限发送验证邮件]")])])])])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("如未完成邮箱验证，再次登录此账号时，仍重定向至邮箱验证页面；")]),s._v(" "),t("p",[s._v("页面中包含"),t("code",[s._v("重新发送邮件")]),s._v("按钮; 点击发送按钮，执行同注册相同逻辑；")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("- 登录时查询用户信息后，如未验证邮箱，不返回token, 只返回用户相关已注册信息(包括send_email_token)；\n- 同样的验证邮箱页面，区分来自于 登录页 / 注册页；\n  [用户申请发送验证邮件，需要带上send_email_token]\n  注册页直接发送邮件接口；\n  登录页需要用户手动操作；\n- 只有当用户点击邮箱链接，将自己的用户状态改为已验证；\n  返回页面后，才能进入页面；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("当用户完成邮箱验证后，刷新用户已验证状态，参照注册流程颁发token，进入系统页面；")])])]),s._v(" "),t("h3",{attrs:{id:"邮箱验证-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#邮箱验证-2"}},[s._v("#")]),s._v(" 邮箱验证")]),s._v(" "),t("p",[s._v("可暂使用"),t("code",[s._v("sendCloud")]),s._v("邮箱服务，免费额度10封/天，可供测试使用；")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("sendCloud")]),s._v("网址： https://www.sendcloud.net/doc/email_v2/code/")])])])}),[],!1,null,null,null);e.default=n.exports}}]);